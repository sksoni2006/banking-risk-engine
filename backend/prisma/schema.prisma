generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Branch {
  id       Int       @id @default(autoincrement())
  name     String
  city     String
  accounts Account[]
  loans    Loan[]
  risks    RiskAlert[]

  @@map("branches")
}

model Customer {
  id        Int       @id @default(autoincrement())
  firstName String
  lastName  String
  dob       DateTime
  accounts  Account[]
  loans     Loan[]
  risks     RiskAlert[]

  @@map("customers")
}

model Account {
  id          Int           @id @default(autoincrement())
  branchId    Int
  customerId  Int
  type        String        // SAVINGS, CURRENT
  balance     Decimal       @db.Decimal(18, 2)
  branch      Branch        @relation(fields: [branchId], references: [id])
  customer    Customer      @relation(fields: [customerId], references: [id])
  transactions Transaction[]

  @@map("accounts")
}

model Transaction {
  id          Int      @id @default(autoincrement())
  accountId   Int
  amount      Decimal  @db.Decimal(18, 2)
  type        String   // CREDIT, DEBIT
  timestamp   DateTime @default(now())
  description String?
  account     Account  @relation(fields: [accountId], references: [id])

  @@map("transactions")
}

model Loan {
  id           Int         @id @default(autoincrement())
  branchId     Int
  customerId   Int
  loanType     String      // HOME, PERSONAL
  principal    Decimal     @db.Decimal(18, 2)
  interestRate Decimal     @db.Decimal(5, 2)
  startDate    DateTime
  termMonths   Int
  status       String      @default("ACTIVE")
  payments     Payment[]
  risks        RiskAlert[]

  branch   Branch   @relation(fields: [branchId], references: [id])
  customer Customer @relation(fields: [customerId], references: [id])

  @@map("loans")
}

model Payment {
  id        Int       @id @default(autoincrement())
  loanId    Int
  dueDate   DateTime
  paidDate  DateTime?
  amount    Decimal   @db.Decimal(18, 2)
  paid      Boolean   @default(false)
  loan      Loan      @relation(fields: [loanId], references: [id])

  @@map("payments")
}

model RiskAlert {
  id         Int      @id @default(autoincrement())
  alertType  String   // NPA, FRAUD, LIQUIDITY
  details    String
  createdAt  DateTime @default(now())
  
  branchId   Int?
  customerId Int?
  loanId     Int?

  branch   Branch?   @relation(fields: [branchId], references: [id])
  customer Customer? @relation(fields: [customerId], references: [id])
  loan     Loan?     @relation(fields: [loanId], references: [id])

  @@map("risk_alerts")
}